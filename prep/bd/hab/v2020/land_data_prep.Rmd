---
title: "land_vegetation_prep"
output: html_document
---
# Summary

This script calculates the land habitat score. While for now it is only based on limited information from CASUP planning documents, I will create a framework to easily include morea accurate spatial data with the distributions of each habitat.

For now, we will calculate the scores using the following assumptions:
- any version of coco forest are not healthy habitat and should be counted as zero
- since we do not know how much of each motu the coco forests takes up, we will give motus with coco forest a zero
- all other habitats listed in the `tet_habitats.csv` are counted as native, and will be a 1
- because Aie, Tahuna Rahu and Tahuna Iti were all referred to as "pristine" in `CASUP_vegetation_and_flora_JYM_2015.docx`, these will get 1s

Each motu will receive a score, and then then scores will be averaged weighted by area of the motu. 

#Set up
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


library(tidyverse)
library(sf)
library(here)
library(janitor)

source(here('workflow/R/common.R'))

#file paths
goal     <- 'hab'
scenario <- 'v2020'
dir_goal      <- file.path(here('prep/bd',goal, scenario))
dir_goal_anx  <- file.path(dir_anx, goal, scenario)
dir_github    <- '~/github/tet-prep'

#read in habitat data

tet_hab <- read_csv(file.path(dir_goal, "_raw_data/tet_habitats.csv")) %>%
  clean_names()
```

#Methods

##Assigning habitat scores

Looking at the habitat data, we can see that there are four motus that have "very dense coco forest". All four also have another type of vegetation. Do some exploring to come up with the best scoring scheme: 

```{r}

#lets see what vegetation types are on the "pristine" atolls

tet_pristine <- tet_hab %>% 
  filter(str_detect(motu, pattern = "AIE") | str_detect(motu, pattern = "TAR") | str_detect(motu, pattern = "TAI"))

#looks like there are only thickets and native forest. These habitats will get a score of 1. 

tet_coco <- tet_hab %>%
  filter(str_detect(motu, pattern = "TIA") | str_detect(motu, pattern = "HIR") | str_detect(motu, pattern = "HOR") | str_detect(motu, pattern = "RIM"))
  
#there are a lot of habitats - come back to this if giving them a score of zero seems too harsh

scored_motus <- c("AIE","TAR","TAI","TIA","HIR","HOR","RIM")

need_score <- tet_motus %>% 
  filter(abb %!in% scored_motus)

```

The ones left are: 
- Onetahi: this motu has the hotel on it, and we don't have it included in the vegetation map. Based on the map Benoit Stoll sent us a link to, we can see that the motu is mostly X. 
- Ahuroa: this is a tiny motu (the fourth smallest). We don't have details for it, but is is right next to Tauvine, so we'll assume it has a similar vegetation make up 
- Tauvine: only shows up in Pemphis thicket, will get a score of 1 since this is a native land cover type
- Reiono: this motu has the most diversity - for now, give it a 0.5
- Honuea: only has cadium marsh, and pandanus forest, both of which are native habitats. Score of 1. 

```{r}

#this can always be adjusted
tet_hab_score <- tet_motus %>%
  mutate(
    abb = as.character(abb)
  ) %>% 
  mutate(
    score = case_when(
      abb %in% c("AIE","TAR","TAI","TAU","AHU","HON") ~ "1",
      abb %in% c("TIA","HIR","HOR","RIM") ~ "0",
      abb %in% c("REI","ONE") ~ "0.5",
      TRUE ~ "0"
    )
  )

```

Next step is to find the total area and the proportion each motu is of that total. That proportion will be the weight applied to that motus score. 

```{r}


hab_stat <- tet_hab_score %>% 
  mutate(
    tot_area = sum(area_km2)
  ) %>% 
  mutate(
    area_prop = area_km2/tot_area
  ) %>% 
  mutate(
    score = as.numeric(score),
    weight_sco = score*area_prop
  ) %>%
  summarise(
    score = mean(weight_sco) #this seems really low?
  )

land_hab_status <- data.frame(
  hab_type = "land",
  status = hab_stat$score,
  year = 2020
)

#write out this draft version to int folder for now

write_csv(land_hab_status, file.path(dir_goal, "int/land_hab_status_draft.csv"))
```

Draft score for land habitat, 2020 is the number in the score column in `land_hab_status` data frame. 

## Using spatial extent data

If we had data showing the extent of each vegetation type, we could instead use a method assessing area covered by native habitat versus coconut habitat. 