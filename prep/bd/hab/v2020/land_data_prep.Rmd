---
title: "land_vegetation_prep"
output: html_document
---
# Summary

This script calculates the land habitat score. Because a long term goal for Tetiaroa is to restore abandoned coconut plantation areas to native vegetation, the status score of the land habitat will be the ratio of native to non native habitat that exists now on the motus. 

Data used for this goal comes from a 2017 forest monitoring monitoring project undertaken by researchers from the University of French Polynesia and Oxford University (CITE). 

[insert more details here once we get Forest Plots data]


Each motu will receive a score, and then then scores will be averaged weighted by area of the motu. 

#Set up
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


library(tidyverse)
library(sf)
library(here)
library(janitor)

source(here('workflow/R/common.R'))

#file paths
goal     <- 'hab'
scenario <- 'v2020'
dir_goal      <- file.path(here('prep/bd',goal, scenario))
dir_goal_anx  <- file.path(dir_anx, goal, scenario)
dir_github    <- '~/github/tet-prep'

#read in habitat data

tet_hab <- read_csv(file.path(dir_goal, "_raw_data/tet_habitats.csv")) %>%
  clean_names()
```

#Methods

##Assigning habitat scores

Looking at the habitat data, we can see that there are four motus that have "very dense coco forest". All four also have another type of vegetation. Do some exploring to come up with the best scoring scheme: 

```{r}

#lets see what vegetation types are on the "pristine" atolls

tet_pristine <- tet_hab %>% 
  filter(str_detect(motu, pattern = "AIE") | str_detect(motu, pattern = "TAR") | str_detect(motu, pattern = "TAI"))

#looks like there are only thickets and native forest. These habitats will get a score of 1. 

tet_coco <- tet_hab %>%
  filter(str_detect(motu, pattern = "TIA") | str_detect(motu, pattern = "HIR") | str_detect(motu, pattern = "HOR") | str_detect(motu, pattern = "RIM"))
  
#there are a lot of habitats - come back to this if giving them a score of zero seems too harsh

scored_motus <- c("AIE","TAR","TAI","TIA","HIR","HOR","RIM")

need_score <- tet_motus %>% 
  filter(abb %!in% scored_motus)

```

The ones left are: 
- Onetahi: this motu has the hotel on it, and we don't have it included in the vegetation map. Based on the map Benoit Stoll sent us a link to, we can see that the motu is mostly coconut grove, or anthropized vegetation (ie landscaped. Since this seems pretty disturbed, we'll give this motu a score of 0.  
- Tauvine: only shows up in Pemphis thicket, will get a score of 1 since this is a native land cover type
- Ahuroa: this is a tiny motu (the fourth smallest). We don't have details for it, but is is right next to Tauvine, so we'll assume it has a similar vegetation make up and get the same score
- Reiono: this motu has the most diversity - for now, give it a 0.5
- Honuea: only has cadium marsh, and pandanus forest, both of which are native habitats. Score of 1. 

```{r}

#this can always be adjusted
tet_hab_score <- tet_motus %>%
  mutate(
    abb = as.character(abb)
  ) %>% 
  mutate(
    score = case_when(
      abb %in% c("AIE","TAR","TAI","TAU","AHU","HON") ~ "1",
      abb %in% c("TIA","HIR","HOR","RIM") ~ "0",
      abb %in% c("REI","ONE") ~ "0.5",
      TRUE ~ "0"
    )
  )

```

Next step is to use the areas of the motus to weight the average score. That proportion will be the weight applied to that motus score. 

```{r}


hab_stat <- tet_hab_score %>% 
  mutate(
    score = as.numeric(score),
    weighted_score = weighted.mean(score, area_km2)
  )

land_hab_status <- data.frame(
  hab_type = "land",
  status = unique(hab_stat$weighted_score),
  year = 2020
)

#write out this draft version to int folder for now

write_csv(land_hab_status, file.path(dir_goal, "int/land_hab_status_draft.csv"))
```

Draft score for land habitat, 2020 is the number in the score column in `land_hab_status` data frame. 

## Using spatial extent data

If we had data showing the extent of each vegetation type, we could instead use a method assessing area covered by native habitat versus coconut habitat. 