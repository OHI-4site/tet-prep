---
title: 'OHI Tetiaroa: Lasting Special Places'
author: "*Compiled on `r date()` by `r Sys.info()['user']`*"
output:
  html_document:
    highlight: haddock
    includes:
      in_header: '../../../workflow/templates/ohi_hdr.html' #this doesn't exist yet
    number_sections: yes
    theme: cerulean
    toc: yes
  pdf_document:
    toc: yes
  word_document:
    toc: yes
---

## Summary

The methods for global are as follows, from Halpern et al. 2012 supplemental info: 

> The ‘Lasting Special Places’ sub-goal focuses instead on those geographic locations that hold particular value for aesthetic, spiritual, cultural, recreational or existence reasons57. This sub-goal is particularly hard to quantify. Ideally one would survey every community around the world to determine the top list of special places, and then assess how those locations are faring relative to a desired state (e.g., protected or well managed). The reality is that such lists do not exist. Instead, we assume areas that are protected represent these special places (i.e. the effort to protect them suggests they are important places).

> Clearly this is an imperfect assumption but in many cases it will be true. Using lists of protected areas as the catalogue of special places then creates the problem of determining a reference condition. We do not know how many special places have yet to be protected, and so we end up having all identified special places also being protected. To solve this problem we make two important assumptions. First, we assume that all countries have roughly the same percentage of their coastal waters and coastline that qualify as lasting special places. In other words, they all have the same reference target (as a percentage of the total area). Second, we assume that the target reference level is 30% of area protected.

The model for this goal considers the inland coastal zone (up to 1 km inland) independently from, and equally weighted with, the offshore coastal zone (up to 3 nm offshore).  The status for this goal is calculated as:

$$X_{LSP} = \frac{\left(\frac{Area_{P}}{Area_{P_{ref}}} + \frac{Area_{MPA}}{Area_{MPA_{ref}}}\right)}{2}$$

where: 

* $Area_{P}$ = Protected area for inland 1 km buffer
* ${Area_{P_{ref}}}$ = Reference value for inland protected area
* $Area_{MPA}$ = Marine protected area for offshore 3 nm buffer
* ${Area_{MPA_{ref}}}$ = Reference value for marine protected area within offshore 3 nm buffer
* $Ref$ = 30% of total area within buffer zone is protected

*** 

Because Tetiaroa is such a small area, we will deviate slightly from these methods. First, instead of just calculating protected area within 1km of the shore, we will treat all land areas as coastal land on Tetiaroa, since most motus (individual islands) are not wider than 1 km anyway. Second, instead of creating a buffer of 3nm and treating that as all offshore, we will split up the marine area into two categories: the lagoon area, and the area extending outwards 3nm from each motu ("offshore"). 

Lastly, we will adjust what we define as "area protected", expressed in terms of stakeholder engagement and number of parties involved in management, in addition to actual protected areas established. This is because we do not think that privately owned areas are truly protected in the same way an offcial, recognized protected area would be. While it is unlikely that the company that owns Tetiaroa (Marlon Brando's trust) would develop it further, they have the full ability to do so, or sell to another party that would. From FourSite's point of view, and taking into account the Tetiaroa's Society's long term goal of making Tetiaroa a nature sanctuary, this still poses a threat that we want to incorporate into the overall score.

Below are the three main areas, with the corresponding ownership / management information: 

| Area | Ownership / Management |
| :---- | :----------- |
| All motus | SA Frangipani |
| Onetahi & Honuea | SA Frangipani and Beachcomber (TBSA) | 
| Lagoon | FP Government, Tetiaroa Society |
| 3nm offshore | FP Government|

The highest protection that exists spans half the lagoon and is considered a protected "no-take zone", which is enforced by rangers employed with the Tetiaroa Society. It is unclear if the government recognizes this area as protected, and recognizes the authority of the Tetiaroa Society rangers in enforcing it. But it is effective in deterring fishing and other harmful activities (see Tetiaroa Society funding report, 2019), so we can consider this area fully protected. 

The land areas of Tetiaroa are split into areas owned soley by the S.A. Frangipani (Marlon Brando's trust), and motus that are owned by SA Frangipani but leased to TBSA, the developer of The Brando Resort. The development of the resort, while damaging in some ways, allowed for the creation of the Tetiaroa Society. TBSA's 2019 sustainability report also provides evidence than preservation and protection are a priority for this stakeholder. Therefore, we'll score these areas slightly higher than the land areas that are only controlled by one party. The reasoning is that there are fewer people involved in the management decisions for areas with only one owner or manager , putting them at a slightly higher risk of being developed or not well protected. 

Lastly, we'll consider any areas that are still under the public domain of the French Polynesian government as having no protection, which will get a score of 0. 


***

## Setup

```{r setup, echo = FALSE, message = FALSE, warning = FALSE}

knitr::opts_chunk$set(fig.width = 6, fig.height = 4, fig.path = 'Figs/',
                      echo = FALSE, message = FALSE, warning = FALSE, eval=FALSE)

library(raster)
library(sf)
library(tidyverse)
library(here)

source(here('workflow/R/common.R'))

goal     <- 'lsp'
scenario <- 'v2020'
dir_goal      <- file.path(here('prep/sp',goal, scenario))
dir_goal_anx  <- file.path(dir_anx, goal, scenario)
dir_github    <- '~/github/tet-prep'


```

## Methods

### Check for overlapping MPAs

First, we'll check the WDPA raster and make sure there aren't any MPAs that fall within our 3nm buffer. Since these all came out as NA, we can conclude there aren't any MPAs in the offshore area. 

```{r, include=FALSE}
#source wdpa raster
rast_wdpa <- raster::raster(file.path(dir_M, 'git-annex/globalprep/lsp/v2020/rast/wdpa_2020_moll_500m.tif')) #note: the numbers for this are 2019, does that seem right?

#to convert into raster needs to be in an sp object instead sfc_POLYGON
tet_buffer_3nm_sp <- as(tet_buffer_3nm,"Spatial")

crop <- crop(rast_wdpa, extent(tet_buffer_3nm_sp), snap="out")

plot(crop)

#this comes out empty, probably not any MPAs in this region 
```

***

### Calculate region areas 

First, we'll calculate the total area of our buffer, and then subtract the areas of the motus and the no-take zone, which we know is 8869 acres in size
``` {r calc_rgn_area, eval = FALSE}

#buffered area = total area of offshore and onshore we are interested in
calc_area_3nm <- st_read(file.path(dir_github, 'spatial/shp'), layer = 'tet_buffer_3nm') %>% 
  mutate(area_m2 = st_area(.),
         area_km2 = area_m2/1000000) %>% 
  separate(area_km2, into = c("area_km2", "units"), sep = " ") %>% 
  dplyr::select(-area_m2, -units)

area_3nm <- as.numeric(calc_area_3nm$area_km2)

total_tet_area <- data.frame(
  region = "total",
  year = 2020,
  area_km2 = area_3nm
)

#export to outputs folder

write_csv(total_tet_area, file.path(dir_goal, 'int/total_tet_area.csv'), append = FALSE)
```


Finding the area of the motus and of the lagoon
``` {r calc_prot_area, eval = FALSE}
#motus - some have one stakeholder, while others have more than one.
#calculate area
area_motus <- st_read(file.path(dir_github, 'spatial/shp'), layer = 'tet_motus_area') %>% 
  dplyr::select(region = name, area_km2) %>% 
  st_set_geometry(.,NULL) %>% 
  mutate(
    year = 2020
  )


#lagoon - half of this is protected with a no take zone.
#convert acres into kilometers squared

no_take_area_km <- 0.00404686*8869

no_take_df <- data.frame(
  region = "No take zone",
  area_km2 = no_take_area_km,
  year = 2020
)

#create df with the motus and the no take zone, which we'll subtract from the total to get the offshore 

prot_areas_total <- bind_rows(area_motus, no_take_df) %>% 
  summarize(
    total_area_km = sum(area_km2)
  )

#now subtract this total from the total to get the offshore area NOT protected, and combine that all into a df

non_prot_areas <- total_tet_area[1,3] - prot_areas_total[1,1]

all_regions_df <- data.frame(
  region = "No protection",
  area_km2 = non_prot_areas,
  year = 2020
) %>% 
  bind_rows(no_take_df, area_motus)

write_csv(all_regions_df, file.path(dir_goal, 'int/all_regions_area.csv'))

```

### Assign scores

Next step is to assign scores from 0 - 1 for each area in the data frame. This step is somewhat arbitrary, and could use input from FourSite to refine. For now, we will score the areas as follows: 

* Areas that are considered public domain and only have one management party will get a 0
* Areas that are protected with enforcement and have multiple stakeholders will get 1 
* Areas that are not protected, but have multiple stakeholders will get 0.7
* Areas that are not protected, but only have one stakeholder will get 0.5

We will assign these scores to each corresponding zone, and then fine the average score weighted by area. 

```{r}

all_regions <- read_csv(file.path(dir_goal,"int/all_regions_area.csv")) %>% 
  mutate(
    status = case_when(
      region %in% "No take zone" ~ 1,
      region %in% "No protection" ~ 0,
      region %in% c("Onetahi", "Honuea") ~ 0.7,
      TRUE ~ 0.5
    )
  )

lsp_status <- all_regions %>% 
  summarize(
    status = weighted.mean(status,area_km2)
  )

#this is super low, consider also making one for just half the lagoon and leaving out the offshore stuff
```


***

## Write out layers

From the protected area files, write out the individual layers ready for the Toolbox[TM]. 

* total area for offshore 3 nm and inland 1 km
* protected area for offshore 3 nm and inland 1 km

``` {r write_layers, eval = FALSE}

prot_3nm <- read_csv(file.path(dir_goal, 'int', 'area_protected_3nm.csv')) %>%
  rename(area = a_tot_km2,
         a_prot_3nm = a_prot_km2)
prot_1km <- read_csv(file.path(dir_goal, 'int', 'area_protected_1km.csv')) %>%
  rename(area = a_tot_km2,
         a_prot_1km = a_prot_km2)

# write_lsp_layer <- function(df, layers, layername) {
#   df1 <- df[ , c('rgn_id', layers)] %>%
#     filter(rgn_id <= 250) %>%
#     distinct()
#   write_csv(df1, file.path(dir_goal, 'output', paste0(layername, '.csv')))
# }

a_tot_3nm <- write_lsp_layer(prot_3nm, 'area', 'rgn_area_offshore3nm')
a_tot_1km <- write_lsp_layer(prot_1km, 'area', 'rgn_area_inland1km')

a_prot_3nm <- write_lsp_layer(prot_3nm, c('year', 'a_prot_3nm'), 'lsp_prot_area_offshore3nm')
a_prot_1km <- write_lsp_layer(prot_1km, c('year', 'a_prot_1km'), 'lsp_prot_area_inland1km')

```

